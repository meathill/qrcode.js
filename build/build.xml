<?xml version="1.0" encoding="UTF-8"?>
<project name="qrcode" default="all" basedir="../">
  <!-- 压缩js，准备部署到sae，目前版本1 -->
  <property name="dist" location="bin/1/" />
  <property name="tools" location=".." />
  
  <taskdef name="jscomp" classname="com.google.javascript.jscomp.ant.CompileTask" classpath="${tools}/compiler.jar" />
  
  <target name="init">
    <mkdir dir="${dist}" />
  </target>
  
  <target name="-copy.html.files">
    <tstamp>
      <format property="build.time" pattern="MMddHHmm" />
    </tstamp>
    <copy file="index.html" todir="${dist}" />
    <replace file="${dist}/index.html" encoding="UTF-8">
      <replacefilter token="@version@" value="${build.time}" />
    </replace>
  </target>
  
  <target name="-compile.css.files">
    <mkdir dir="${dist}/css" />
    <java jar="${tools}/closure-stylesheets.jar" fork="true">
      <arg line="--output-file ${dist}/css/qrcode.css" />
      <arg line="css/qrcode.css" />
    </java>
    <java jar="${tools}/closure-stylesheets.jar" fork="true">
      <arg line="--output-file ${dist}/css/style.css" />
      <arg line="css/style.css" />
    </java>
  </target>
  
  <target name="-copy.js.files">
    <copy file="libs/ZeroClipboard.min.js" todir="${dist}/libs" />
  </target>
  
  <target name="-copy.swf.files">
    <copy file="swf/ZeroClipboard.swf" todir="${dist}/swf" />
  </target>
  
  <target name="-copy.tempaltes">
    <copy file="templates/output.html" todir="${dist}/templates" />
  </target>
  
  <target name="-compile.js.files">
    <mkdir dir="${dist}/libs" />
    <mkdir dir="${dist}/js" />
    <jscomp compilationLevel="simple" warning="default" debug="false" output="${dist}/libs/handlebars.js" encoding="UTF-8">
      <warning group="internetExplorerChecks" level="OFF" />
      <warning group="globalThis" level="OFF" />
      <sources dir="libs/">
        <file name="handlebars.js" />
      </sources>
    </jscomp>
    <jscomp compilationLevel="simple" warning="default" debug="false" output="${dist}/libs/qrcode.js" encoding="UTF-8">
      <warning group="internetExplorerChecks" level="OFF" />
      <warning group="globalThis" level="OFF" />
      <sources dir="libs/">
        <file name="qrcode.js" />
      </sources>
    </jscomp>
    <jscomp compilationLevel="simple" warning="default" debug="false" output="${dist}/js/main.js" encoding="UTF-8">
      <warning group="internetExplorerChecks" level="OFF" />
      <warning group="globalThis" level="OFF" />
      <sources dir="js/">
        <file name="main.js" />
      </sources>
    </jscomp>
  </target>
  
  <target name="all" depends="init, -copy.html.files, -compile.css.files, -copy.js.files, -copy.tempaltes, -copy.swf.files, -compile.js.files">
    
  </target>
</project>
